# THIS FILE CREATES A HASH TABLE OF C AND KT VALUES FOR FLOW OVER ROAD
# AND A FUNCTION THAT RETURNS A LIST OF C VALUES FOR THE ROAD.
# USGS TWRI B3ChA5 p.26
# Several tables now follow with reference to figure number and the
# curve type from the figures. Each table is first and matrix that is
# cast into a data.frame with renaming of the columns to the axis labels
# from the original figure.
fig22.gravel <-
as.data.frame(matrix(c(
0.15,  2.94979757085,
0.160239005736,  2.95937018602,
0.169990439771,  2.96975716243,
0.180066921606,  2.98013949420,
0.189980879541,  2.98971443169,
0.200057361377,  2.99969190516,
0.210296367113,  3.01047677290,
0.220210325048,  3.02045656869,
0.229961759082,  3.03043868680,
0.240363288719,  3.04041151563,
0.247189292543,  3.04719656915,
0.249789674952,  3.05039827838,
0.257590822180,  3.05757425628,
0.260191204589,  3.06037110721,
0.268154875717,  3.06713990448,
0.270755258126,  3.06993675541,
0.280019120459,  3.07749669069,
0.287820267686,  3.08183866048,
0.294808795411,  3.08497766699,
0.300009560229,  3.08692764416,
0.306998087954,  3.08844721747,
0.310736137667,  3.08920352064,
0.32,  3.0894829735), ncol=2, byrow=TRUE));
names(fig22.gravel) <- c("h.over.L", "C");

fig22.paved <-
as.data.frame(matrix(c(
0.15,  3.04817813765,
0.156175908222,  3.05254565300,
0.160076481836,  3.05491906705,
0.166414913958,  3.05847222115,
0.169990439771,  3.06125513814,
0.180229445507,  3.06556227309,
0.186892925430,  3.06830106595,
0.190143403442,  3.07108862758,
0.195181644359,  3.07263606877,
0.200057361377,  3.07418583228,
0.209971319312,  3.07687817868,
0.220047801147,  3.08037791935,
0.229636711281,  3.08186033550,
0.240200764818,  3.08454339260,
0.249789674952,  3.08602580875,
0.259703632887,  3.08628900535,
0.269780114723,  3.08857417112,
0.280181644359,  3.08923525906,
0.290095602294,  3.08949845566,
0.299684512428,  3.09017115520,
0.310086042065,  3.08961766823,
0.32,  3.08988550948), ncol=2, byrow=TRUE));
names(fig22.paved) <- c("h.over.L", "C");

fig23.gravel <-
as.data.frame(matrix(c(
0,  2.5,
0.0459917998543,  2.52068965517,
0.103577674013,  2.54062066747,
0.153419376942,  2.56131254090,
0.203290656591,  2.58047381906,
0.256997050955,  2.60116791074,
0.295318621380,  2.61802664123,
0.356739610253,  2.63949046705,
0.406625678262,  2.65788644758,
0.479596376359,  2.68165282106,
0.544867268306,  2.70388416278,
0.602512295905,  2.72075398454,
0.687077068306,  2.74452701279,
0.794682105715,  2.7759663269,
0.894646490414,  2.80280941871,
0.963870803957,  2.82045119287,
1.02923042606,  2.83809074877,
1.10239337284,  2.85190825301,
1.17555631962,  2.86572575726,
1.25640428419,  2.88184359091,
1.35271101449,  2.89797029758,
1.44903253316,  2.91333170661,
1.52223984502,  2.92485331795,
1.59546194524,  2.93560963166,
1.68412802283,  2.94714011601,
1.75355937342,  2.95406772329,
1.82681105036,  2.96329344173,
1.96182384845,  2.9763811404,
2.03513467883,  2.9825456683,
2.10840114413,  2.99100608911,
2.19330604881,  2.99717727177,
2.30136952538,  3.00489235922,
2.40168883072,  3.0133683078,
2.50206728950,  3.01878306585,
2.60243095992,  3.02496312153,
2.69123013276,  3.02960592717,
2.79163816826,  3.03349008995,
2.89204620377,  3.03737425273,
2.98860433619,  3.04049089961,
3.09286227477,  3.04514257828,
3.28215821327,  3.04907776089,
3.44832515660,  3.04993844345,
3.57970987702,  3.05077916172,
3.73428274605,  3.05163318952,
3.85799723704,  3.04940828074,
3.95073504311,  3.05022681647,
4.0,  3.05178181254), ncol=2, byrow=TRUE));
names(fig23.gravel) <- c("H", "C");

fig23.paved <-
as.data.frame(matrix(c(
0,  2.84132496312,
0.0158974870879,  2.87807034083,
0.0425658297687,  2.8979836071,
0.0731136522443,  2.91713379399,
0.115225972304,  2.93782123091,
0.161232560518,  2.95698029081,
0.203463187458,  2.97154534666,
0.257302677063,  2.98535175963,
0.315051223182,  2.99686449795,
0.376694037456,  3.00684885926,
0.442245908246,  3.01453954592,
0.496248069811,  3.01992768492,
0.550265019736,  3.02455052628,
0.612011352531,  3.02917780415,
0.666087455897,  3.03073945497,
0.739487016436,  3.03231219707,
0.812842211895,  3.03618083207,
0.913324189197,  3.03623850667,
1.006047206910,  3.03782234004,
1.098799801340,  3.03787557813,
1.195417087210,  3.03793103448,
1.404095636320,  3.03881611783,
1.605059590930,  3.03893146704,
1.883287797510,  3.04062177660,
2.188583632490,  3.04156231630,
2.474556010300,  3.04249176473,
2.609775845430,  3.04486529653,
2.799160514090,  3.04420869334,
3.015524081000,  3.04739410610,
3.185555715760,  3.04825700691,
3.409693030620,  3.04915096328,
3.575845185590,  3.05077694347,
3.718838768670,  3.05085901887,
3.850223489090,  3.05169973714,
4.0,  3.05178181254), ncol=2, byrow=TRUE));
names(fig23.paved) <- c("H", "C");

fig24.gravel <-
as.data.frame(matrix(c(
0.691593743766, 1,
0.720969341118, 0.997572627636,
0.741067775869, 0.996397648404,
0.760782714072, 0.993296998425,
0.778950565270, 0.990968254346,
0.789003057849, 0.988262117508,
0.799829689421, 0.984784819134,
0.809498685452, 0.980153011550,
0.819942415969, 0.974364833843,
0.825744885472, 0.970892373838,
0.831162667445, 0.966264660257,
0.838513414936, 0.961249877180,
0.846639492403, 0.954693515395,
0.851671395862, 0.949680965411,
0.858639837788, 0.941970094415,
0.864445880241, 0.936186382895,
0.872189056652, 0.927319141778,
0.877998672054, 0.919224178743,
0.883422408942, 0.910744379304,
0.888458480842, 0.903035369220,
0.893110460702, 0.893785896974,
0.896599445597, 0.886848792790,
0.901250234475, 0.878369737716,
0.904355127331, 0.869892171371,
0.907072355199, 0.862185394379,
0.909788987575, 0.854863825974,
0.912506215443, 0.847157048982,
0.915223443311, 0.839450271991,
0.917168914151, 0.830973822192,
0.921048541492, 0.821339885725,
0.922609324802, 0.811708182351,
0.925331912094, 0.800534528088,
0.928435613967, 0.792827378914,
0.929219280825, 0.785892880005,
0.932327746630, 0.775104062145,
0.935053311380, 0.762004364953,
0.939337277472, 0.740813798730,
0.943620052582, 0.720393649678,
0.947902827692, 0.699973500627,
0.951024989802, 0.680324885293,
0.953762464382, 0.659521016385,
0.957658169995, 0.639486448101,
0.960779736614, 0.620223041354,
0.964289563713, 0.599803636667,
0.966638182322, 0.580540974284,
0.968214448411, 0.560893847679,
0.971723084527, 0.541244860164,
0.974075276085, 0.519670946266,
0.976423894693, 0.5), ncol=2, byrow=TRUE));
names(fig24.gravel) <- c("ht.over.H", "kt");

fig24.paved <-
as.data.frame(matrix(c(
0.794782898674, 1,
0.807926587804, 0.997103678053,
0.817590819903, 0.995553539155,
0.827643907973, 0.992462193731,
0.838085852014, 0.987829641782,
0.850462548049, 0.981654394579,
0.858587434533, 0.975868449965,
0.867100581497, 0.968926507412,
0.873293097955, 0.963142423710,
0.880260348898, 0.956201969886,
0.886455247323, 0.948877051841,
0.892651932221, 0.940396508038,
0.898462143114, 0.931916336417,
0.905048279476, 0.921509377503,
0.910476184805, 0.910333117964,
0.915129355648, 0.900313228547,
0.920169595989, 0.889907758361,
0.924437483810, 0.879117823955,
0.927932423621, 0.868328633913,
0.931424385974, 0.859465486799,
0.933758117294, 0.849833039061,
0.936092444106, 0.839815382737,
0.940366882334, 0.824788153887,
0.942307589242, 0.819393372775,
0.946201508380, 0.800514430249,
0.950095427518, 0.781635487722,
0.954378798119, 0.760830130085,
0.957501555722, 0.740796306166,
0.961397261334, 0.720761737882,
0.963748857401, 0.699573032570,
0.967643967522, 0.679923672873,
0.969221424594, 0.659506129097,
0.973116534716, 0.639856769399,
0.975079274810, 0.620209270612,
0.976656136391, 0.600176935422,
0.979778298502, 0.580528320089,
0.981741634088, 0.560495612716,
0.983703778692, 0.541233322515,
0.986054779266, 0.520429825789,
0.986472218831, 0.5), ncol=2, byrow=TRUE));
names(fig24.paved) <- c("ht.over.H", "kt");

RoadCvals.h <- new.h(); # Create the parent container of C and kt tables
# Make some handy notes
set.h("reference",
      "The figure numbers referenced are for USGS TWRI Book3 Chapter4",
      RoadCvals.h);
set.h("source",
      paste(c("Dr. Theodore Cleveland (TTU, Lubbock, Texas) digitized ",
              "the figures from jpgs on Dec. 19, 2009 using G3data software. ",
              "Dr. William Asquith (USGS, Lubbock, Texas) implemented in R."),
              collapse=""),
      RoadCvals.h);
# Populate the hash with the tables of the figures.
set.h("fig22.gravel", fig22.gravel, RoadCvals.h);
set.h("fig23.gravel", fig23.gravel, RoadCvals.h);
set.h("fig24.gravel", fig24.gravel, RoadCvals.h);
set.h("fig22.paved",  fig22.paved,  RoadCvals.h);
set.h("fig23.paved",  fig23.paved,  RoadCvals.h);
set.h("fig24.paved",  fig24.paved,  RoadCvals.h);

# Now remove the temporary storage units as RoadCvals.h holds contents now.
rm(fig22.gravel, fig23.gravel, fig24.gravel,
   fig22.paved,  fig23.paved,  fig24.paved);

"Croad" <-
function(H=NULL, h=NULL, ht=HULL, L=NULL, type=c("paved", "gravel")) {

  if(! is.h(RoadCvals.h)) {
    stop("Hash tables of C and kt values (RoadCvals.h) for flow over road is missing");
  }

  type <- match.arg(type);

  if(h > H) {
     stop("h > H, physically impossible, velocity head problem?");
  }

  if(type == "gravel") {
     fig22 <- get.h("fig22.gravel", RoadCvals.h);
     fig23 <- get.h("fig23.gravel", RoadCvals.h);
     fig24 <- get.h("fig24.gravel", RoadCvals.h);
  } else {
     fig22 <- get.h("fig22.paved",  RoadCvals.h);
     fig23 <- get.h("fig23.paved",  RoadCvals.h);
     fig24 <- get.h("fig24.paved",  RoadCvals.h);
  }

  ht.over.H <- ht/H;
  h.over.L  <- h/L;
  which.fig <- ""
  if(h.over.L >= 0.15) {
    Cbase <- approx(fig22$h.over.L, y=fig22$C,
                    xout=h.over.L, rule=2)$y;
    which.fig <- "Cbase from fig22";
  } else {
    Cbase <- approx(fig23$H, y=fig23$C,
                    xout=H, rule=2)$y;
    which.fig <- "Cbase from fig23";
  }
  kt <- approx(fig24$ht.over.H, y=fig24$kt,
               xout=ht.over.H, rule=2)$y;
  return(list(Croad=kt*Cbase, kt=kt, Cbase=Cbase,
              fig=which.fig, ht.over.H=ht.over.H, h.over.L=h.over.L));
}

#Croad(h=6, H=6.4, L=100, ht=0, type="paved")




